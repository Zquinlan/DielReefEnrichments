axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
# legend.position = "none"# get rid of legend panel bg
) +
ggtitle("OTUs")
dev.off()
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"),
legend.position = "none"# get rid of legend panel bg
) +
ylab("Relative Abundance") +
ggtitle("OTUs")
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"),
legend.position = "none"# get rid of legend panel bg
) +
ylab("Relative Abundance") +
ggtitle("OTUs")
colors_otus <- c("#FF0000", #Altermonas Red
"#32806E", #Flavobacters greenish
"#91A737",
"olivedrab4",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"turquoise3", # Rhodobacters Blue
"#5BBCD6",
"steelblue3",
"steelblue3",
"royalblue2",
"slateblue4",
"slateblue4",
"slateblue4")
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
# legend.position = "none"# get rid of legend panel bg
) +
ggtitle("OTUs")
colors_otus <- c("#FF0000", #Altermonas Red
"firebrick2"
"#32806E", #Flavobacters greenish
"#91A737",
"olivedrab4",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"olivedrab2",
# "turquoise3", # Rhodobacters Blue
"#5BBCD6",
"steelblue3",
"steelblue3",
"royalblue2",
"slateblue4",
"slateblue4",
"slateblue4")
colors_otus <- c("#FF0000", #Altermonas Red
"firebrick2",
"#32806E", #Flavobacters greenish
"#91A737",
"olivedrab4",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"olivedrab2",
# "turquoise3", # Rhodobacters Blue
"#5BBCD6",
"steelblue3",
"steelblue3",
"royalblue2",
"slateblue4",
"slateblue4",
"slateblue4")
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
# legend.position = "none"# get rid of legend panel bg
) +
ggtitle("OTUs")
colors_otus <- c("#FF0000", #Altermonas Red
"firebrick2",
"#32806E", #Flavobacters greenish
"#91A737",
"olivedrab4",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"turquoise3", # Rhodobacters Blue
"#5BBCD6",
"steelblue3",
"steelblue3",
"royalblue2",
"slateblue4",
"slateblue4",
"slateblue4")
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
# legend.position = "none"# get rid of legend panel bg
) +
ggtitle("OTUs")
colors_otus <- c("#FF0000", #Altermonas Red
"firebrick4",
"#32806E", #Flavobacters greenish
"#91A737",
"olivedrab4",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"turquoise3", # Rhodobacters Blue
"#5BBCD6",
"steelblue3",
"steelblue3",
"royalblue2",
"slateblue4",
"slateblue4",
"slateblue4")
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
# legend.position = "none"# get rid of legend panel bg
) +
ggtitle("OTUs")
pdf("~/Documents/GitHub/DORCIERR/data/plots/osm_otus.pdf", width = 7, height = 5)
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"),
legend.position = "none"# get rid of legend panel bg
) +
ylab("Relative Abundance") +
ggtitle("OTUs")
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
# legend.position = "none"# get rid of legend panel bg
) +
ggtitle("OTUs")
dev.off()
head(fcm_graphing)
# GRAPHING -- [OSM] FCM data ----------------------------------------------------
fcm_graphing <- fcm_wdf%>%
filter(!Organism == 'Influent',
!Organism == 'Offshore',
Organism != "Turf",
Organism != "Porites lobata")
head(fcm_graphing)
# GRAPHING -- [OSM] PCoAs Labile ------------------------------------------
osm_dom_pco <- dom_stats_wdf%>%
spread(Timepoint, log)%>%
filter(Organism != "Turf",
Organism != "Porites lobata")%>%
filter(DayNight == "Day")%>%
group_by(feature_number, Organism, DayNight)%>%
mutate(mean_t0 = mean(T0, na.rm = TRUE))%>%
mutate(change = TF - mean_t0)%>%
ungroup()%>%
mutate(zscore = ((change - mean(change, na.rm = TRUE))/sd(change, na.rm = TRUE)))%>%
mutate(zscore = zscore + 78)%>%
select(-c(TF, T0, mean_t0, change))%>%
unite(sample, c(1:4), sep = "_")%>%
spread(2,3)%>%
column_to_rownames(var = "sample")%>%
vegdist(na.rm = TRUE)%>%
pcoa()
## Plot Eigenvalues
osm_dom_pco$values[1:10,]%>%
as.data.frame()%>%
rownames_to_column("Axis")%>%
mutate(axis = as.numeric(Axis))%>%
ggplot(aes(reorder(Axis, axis), Relative_eig, label = round(Relative_eig, digits = 3))) +
geom_bar(stat = "identity") +
geom_text(size = 3, color = "red", vjust = -0.5)
osm_dom_pco$vectors%>%
as.data.frame()%>%
rownames_to_column(var = "sample")%>%
separate(sample, c("experiemnt", "Organism", "replicate", "DayNight"), sep = "_")%>%
ggplot(., aes(x = Axis.1, y = Axis.2, color = Organism, shape = DayNight)) +
geom_point(stat = "identity", aes(size = 0.2)) +
scale_shape_manual(values = c(1,19)) +
scale_color_manual(values = c("#FF0000", "#50A45C", "#F69100", "#5BBCD6")) +
theme(
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major.y = element_line(size = 0.2, linetype = 'solid',colour = "gray"), # get rid of major grid
panel.grid.major.x = element_line(size = 0.2, linetype = 'solid',colour = "gray"), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"), # get rid of legend panel bg
legend.text = element_text(face = "italic")) +
xlab(str_c("Axis 1", " (", round(osm_dom_pco$values$Relative_eig[1], digits = 4)*100, "%)", sep = "")) +
ylab(str_c("Axis 2", " (", round(osm_dom_pco$values$Relative_eig[2], digits = 4)*100, "%)", sep = "")) +
ggtitle("Labile features")
## PCoA plot
pdf("./plots/osm_dom_pcoa.pdf", width = 6, height = 5)
osm_dom_pco$vectors%>%
as.data.frame()%>%
rownames_to_column(var = "sample")%>%
separate(sample, c("experiemnt", "Organism", "replicate", "DayNight"), sep = "_")%>%
ggplot(., aes(x = Axis.1, y = Axis.2, color = Organism, shape = DayNight)) +
geom_point(stat = "identity", aes(size = 0.2)) +
scale_shape_manual(values = c(1,19)) +
scale_color_manual(values = c("#FF0000", "#50A45C", "#F69100", "#5BBCD6")) +
theme(
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major.y = element_line(size = 0.2, linetype = 'solid',colour = "gray"), # get rid of major grid
panel.grid.major.x = element_line(size = 0.2, linetype = 'solid',colour = "gray"), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"), # get rid of legend panel bg
legend.text = element_text(face = "italic")) +
xlab(str_c("Axis 1", " (", round(osm_dom_pco$values$Relative_eig[1], digits = 4)*100, "%)", sep = "")) +
ylab(str_c("Axis 2", " (", round(osm_dom_pco$values$Relative_eig[2], digits = 4)*100, "%)", sep = "")) +
ggtitle("Labile features")
dev.off()
# GRAPHING -- [OSM] PCoAs microbes ------------------------------------------
osm_pcoa_microbe <- microbe_no_rare%>%
filter(Timepoint == "TF",
Organism != "Turf",
Organism != "Porites lobata",
DayNight == "Day")%>%
unite(sample, c(Organism, DayNight, Replicate), sep = "_")%>%
select(-c(sample_code, Experiment, Timepoint,
numOtus, sum, reads, ra))%>%
group_by(sample, OTU)%>%
summarize_if(is.numeric, sum)%>%
ungroup()%>%
mutate(zscore = (log10 -mean(log10))/sd(log10))%>%
mutate(zscore = zscore + 0.75)%>%
select(-c(log10, `Cells µL-1`, cell_abun))%>%
spread(OTU, zscore)%>%
column_to_rownames("sample")%>%
vegdist(na.rm = TRUE)%>%
pcoa()
# GRAPHING -- [OSM] PCoAs microbes ------------------------------------------
osm_pcoa_microbe <- microbe_no_rare%>%
filter(Timepoint == "TF",
Organism != "Turf",
Organism != "Porites lobata",
DayNight == "Day")%>%
unite(sample, c(Organism, DayNight, Replicate), sep = "_")%>%
select(-c(sample_code, Experiment, Timepoint,
numOtus, sum, reads, ra))%>%
group_by(sample, OTU)%>%
summarize_if(is.numeric, sum)%>%
ungroup()%>%
mutate(zscore = (log10 -mean(log10))/sd(log10))
View(osm_pcoa_microbe)
# GRAPHING -- [OSM] PCoAs microbes ------------------------------------------
osm_pcoa_microbe <- microbe_no_rare%>%
filter(Timepoint == "TF",
Organism != "Turf",
Organism != "Porites lobata",
DayNight == "Day")%>%
unite(sample, c(Organism, DayNight, Replicate), sep = "_")%>%
select(-c(sample_code, Experiment, Timepoint,
numOtus, sum, reads, ra))%>%
group_by(sample, OTU)%>%
summarize_if(is.numeric, sum)%>%
ungroup()%>%
mutate(zscore = (log10 -mean(log10))/sd(log10))%>%
mutate(zscore = zscore + 0.76)%>%
select(-c(log10, `Cells µL-1`, cell_abun))%>%
spread(OTU, zscore)%>%
column_to_rownames("sample")%>%
vegdist(na.rm = TRUE)%>%
pcoa()
## Plot Eigenvalues
osm_pcoa_microbe$values[1:10,]%>%
as.data.frame()%>%
rownames_to_column("Axis")%>%
mutate(axis = as.numeric(Axis))%>%
ggplot(aes(reorder(Axis, axis), Relative_eig, label = round(Relative_eig, digits = 3))) +
geom_bar(stat = "identity") +
geom_text(size = 3, color = "red", vjust = -0.5)
osm_pcoa_microbe$vectors%>%
as.data.frame()%>%
rownames_to_column(var = "sample")%>%
separate(sample, c("Organism", "DayNight", "Replicate"), sep = "_")%>%
ggplot(., aes(x = Axis.1, y = Axis.2, color = Organism, shape = DayNight)) +
geom_point(stat = "identity", aes(size = 0.2)) +
scale_shape_manual(values = c(1,19)) +
scale_color_manual(values = c("#FF0000", "#50A45C", "#F69100", "#5BBCD6")) +
theme(
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major.y = element_line(size = 0.2, linetype = 'solid',colour = "gray"), # get rid of major grid
panel.grid.major.x = element_line(size = 0.2, linetype = 'solid',colour = "gray"), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"), # get rid of legend panel bg
legend.text = element_text(face = "italic")) +
xlab(str_c("Axis 1", " (", round(osm_pcoa_microbe$values$Relative_eig[1], digits = 4)*100, "%)", sep = "")) +
ylab(str_c("Axis 2", " (", round(osm_pcoa_microbe$values$Relative_eig[2], digits = 4)*100, "%)", sep = "")) +
ggtitle("microbial communities")
## PCoA plot
pdf("./plots/osm_microbes_pcoa.pdf", width = 6, height = 5)
osm_pcoa_microbe$vectors%>%
as.data.frame()%>%
rownames_to_column(var = "sample")%>%
separate(sample, c("Organism", "DayNight", "Replicate"), sep = "_")%>%
ggplot(., aes(x = Axis.1, y = Axis.2, color = Organism, shape = DayNight)) +
geom_point(stat = "identity", aes(size = 0.2)) +
scale_shape_manual(values = c(1,19)) +
scale_color_manual(values = c("#FF0000", "#50A45C", "#F69100", "#5BBCD6")) +
theme(
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major.y = element_line(size = 0.2, linetype = 'solid',colour = "gray"), # get rid of major grid
panel.grid.major.x = element_line(size = 0.2, linetype = 'solid',colour = "gray"), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"), # get rid of legend panel bg
legend.text = element_text(face = "italic")) +
xlab(str_c("Axis 1", " (", round(osm_pcoa_microbe$values$Relative_eig[1], digits = 4)*100, "%)", sep = "")) +
ylab(str_c("Axis 2", " (", round(osm_pcoa_microbe$values$Relative_eig[2], digits = 4)*100, "%)", sep = "")) +
ggtitle("microbial communities")
dev.off()
# GRAPHING -- [OSM] Important OTUs --------------------------------------------------------
osm_otus <- dunnett_microbe_pvals%>%
left_join(microbe_taxonomy, by = "OTU")%>%
# filter(Organism != "Turf",
#        Organism != "Porites lobata")%>%
inner_join(ra_bigger_TF, by = c("DayNight", "Organism", "OTU"))%>%
left_join(average_ra, by = c("OTU", "Organism", "DayNight"))%>%
separate(Taxonomy, c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "sp"), sep = ";")%>%
unite(Tax_plot, c("Order", "Family", "Genus", "OTU"), sep = " ", remove = FALSE)
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
# scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
# legend.position = "none"# get rid of legend panel bg
) +
ggtitle("OTUs")
# GRAPHING -- [OSM] Important OTUs --------------------------------------------------------
osm_otus <- dunnett_microbe_pvals%>%
left_join(microbe_taxonomy, by = "OTU")%>%
filter(Organism != "Turf",
Organism != "Porites lobata")%>%
inner_join(ra_bigger_TF, by = c("DayNight", "Organism", "OTU"))%>%
left_join(average_ra, by = c("OTU", "Organism", "DayNight"))%>%
separate(Taxonomy, c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "sp"), sep = ";")%>%
unite(Tax_plot, c("Order", "Family", "Genus", "OTU"), sep = " ", remove = FALSE)
colors_otus <- c("#FF0000", #Altermonas Red
"firebrick4",
"#32806E", #Flavobacters greenish
"#91A737",
"olivedrab4",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"olivedrab2",
"turquoise3", # Rhodobacters Blue
"#5BBCD6",
"steelblue3",
"steelblue3",
"royalblue2",
"slateblue4",
"slateblue4",
"slateblue4")
osm_otus%>%
filter(ra >= 0.010)%>%
ggplot(aes(x = Organism, y = ra, fill = Tax_plot)) +
geom_bar(stat = "summary", fun.y = "mean", position = "stack") +
facet_wrap(~DayNight) +
# scale_color_manual(values = "black") +
scale_fill_manual(values = colors_otus) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent"),
legend.position = "none"# get rid of legend panel bg
) +
ylab("Relative Abundance") +
ggtitle("OTUs")
