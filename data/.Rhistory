gen_theme()
pcnt_means <- sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
group_by(variable)%>%
mutate(mean_release = mean(prcnt_release, na.rm = TRUE))%>%
select(variable, mean_release)%>%
unique()%>%
ungroup()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.01,
label = paste(round(mean_release, digits = 4)*100, '%', sep = ""))) +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.008,
label = paste(round(mean_release, digits = 4)*100, '%', sep = ""))) +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.005,
label = paste(round(mean_release, digits = 4)*100, '%', sep = ""))) +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.0035,
label = paste(round(mean_release, digits = 4)*100, '%', sep = ""))) +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.004,
label = paste(round(mean_release, digits = 4)*100, '%', sep = ""))) +
gen_theme()
pdf('~/Documents/SDSU_Scripps/Haley/Tile_release_10x/plots.pdf')
sdm_change%>%
ggplot(aes(Treatment, log10(change))) +
geom_boxplot() +
facet_wrap(~variable) +
gen_theme()
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Treatment, log10)) +
geom_boxplot() +
geom_point() +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units)))) +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.004,
label = paste(round(mean_release, digits = 4)*100, '%', sep = ""))) +
gen_theme()
dev.off()
pdf('~/Documents/SDSU_Scripps/Haley/Tile_release_10x/checking_normality.pdf')
sdm_gaussian <- sdm_14%>%
group_by(variable)%>%
nest()%>%
mutate(data = map(data, ~ select(.x, value)%>%
as.matrix()%>%
car::qqPlot(ylab = variable, xlab = "Normal quantiles",
main = paste(variable, 'normality'))))
dev.off()
# fDOM analysis of realease for CCA exudates from tiles
# WRiten by Zach Quinlan for Haley 02/03/2021
# LOADING -- packages -------------------------------------------------------
#Data mungering
library(tidyverse)
library(data.table)
library(DescTools)
library(broom)
library(readxl)
library(multcomp)
library(CHNOSZ)
library(furrr)
library(future)
library(biclustermd)
library(webchem)
library(classyfireR)
library(randomForest)
library(ggpubr)
library(rsq)
#PCoA, PERMANOVA
library(vegan)
library(ape)
#Visualizations
library(wesanderson)
library(RColorBrewer)
library(gplots)
library(gtable)
library(ggnewscale)
library(ggforce)
#modeling
library(yardstick)
library(glmnet)
#Defining functions and removing issues with overlapping function calls
map <- purrr::map
select <- dplyr::select
tidy <- broom::tidy
rename <- dplyr::rename
mutate <- dplyr::mutate
zscore <- function(x) {
(x-mean(x, na.rm = TRUE))/sd(x, na.rm = TRUE)
}
gen_theme <- function(x) {
theme(
legend.position = "top",
legend.text = element_text(size = 20),
legend.title = element_text(size = 25),
legend.key = element_rect(fill = "transparent"),
legend.key.size = unit(3, 'line'),
title = element_text(size = 25),
plot.margin = unit(c(1,1,1.5,1.2), 'cm'),
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(angle = 60, hjust = 1, size = 30),
axis.text.y = element_text(size = 30),
axis.title = element_text(size = 30),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank())
}
# LOADING -- Dataframe ----------------------------------------------------
sdm_raw <- read_xlsx('~/Documents/SDSU_Scripps/Haley/Tile_release_10x/SummaryDataMatrix.xlsx')
# CLEANING -- Raw Data ----------------------------------------------------
sdm_clean <- sdm_raw%>%
filter(!`Sample Name` %like% '%LANK%',
!`Sample Name` %like% '%lank%',
!`Sample Name` %like% '%milliq%',
!`Sample Name` %like% '%control3%',
!`Sample Name` %like% 'NHL_control4%')%>%
select(-c(2:10, `Optical Brighteners`:ncol(.)))%>%
separate(`Sample Name`, c('Experiment', 'Treatment', 'Timepoint'), sep = '_')%>%
separate(Treatment, c('Treatment', 'Replicate'), sep = -1)
sdm_change <- sdm_clean%>%
filter(Timepoint == 'd14' | Timepoint == 'd1',
Experiment != 'CCA')%>%
gather(variable, value, 5:ncol(.))%>%
spread(Timepoint, value)%>%
mutate(change = d14-d1)
cca_bulk <- sdm_clean%>%
filter(Experiment == 'CCA')%>%
gather(variable, bulk_cca, 5:ncol(.))%>%
mutate(log10_bulk = log10(bulk_cca))%>%
select(Timepoint, variable, bulk_cca, log10_bulk)
sdm_14 <- sdm_clean%>%
filter(Timepoint == 'd14',
Experiment != 'CCA')%>%
gather(variable, value, 5:ncol(.))%>%
mutate(log10 = log10(value))
sdm_difference <- sdm_14%>%
select(-log10)%>%
spread(Treatment, value)%>%
group_by(variable, Experiment)%>%
mutate(control = mean(control, na.rm = TRUE),
cca_release = CCAn - control,
log10_release = log10(cca_release),
log10_release = replace(log10_release, is.na(log10_release), 0))%>%
ungroup()%>%
left_join(cca_bulk, by = c('Timepoint', 'variable'))%>%
mutate(prcnt_release = cca_release/bulk_cca)
# CHECKING GAUSSIAN -------------------------------------------------------
pdf('~/Documents/SDSU_Scripps/Haley/Tile_release_10x/checking_normality.pdf')
sdm_gaussian <- sdm_14%>%
group_by(variable)%>%
nest()%>%
mutate(data = map(data, ~ select(.x, value)%>%
as.matrix()%>%
car::qqPlot(ylab = variable, xlab = "Normal quantiles",
main = paste(variable, 'normality'))))
dev.off()
# PLOTTING -- change over time --------------------------------------------
# Change over time
pcnt_means <- sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
group_by(variable)%>%
mutate(mean_release = mean(prcnt_release, na.rm = TRUE))%>%
select(variable, mean_release)%>%
unique()%>%
ungroup()
pdf('~/Documents/SDSU_Scripps/Haley/Tile_release_10x/plots.pdf', width = 15, height = 10)
sdm_change%>%
ggplot(aes(Treatment, log10(change))) +
geom_boxplot() +
facet_wrap(~variable) +
gen_theme()
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Treatment, log10)) +
geom_boxplot() +
geom_point() +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units)))) +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.004,
label = paste(round(mean_release, digits = 4)*100, '%', sep = ""))) +
gen_theme()
dev.off()
View(sdm_difference)
# PLOTTING -- change over time --------------------------------------------
# Change over time
pcnt_means <- sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
group_by(variable, Experiment)%>%
mutate(mean_release = mean(prcnt_release, na.rm = TRUE))%>%
select(variable, Experiment, mean_release)%>%
unique()%>%
ungroup()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.004, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = ""))) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
?geom_text
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.004, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = 'dodge2') +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.004, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = 'dodge') +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.004, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
# CLEANING -- Raw Data ----------------------------------------------------
sdm_clean <- sdm_raw%>%
filter(!`Sample Name` %like% '%LANK%',
!`Sample Name` %like% '%lank%',
!`Sample Name` %like% '%milliq%',
!`Sample Name` %like% '%control3%',
!`Sample Name` %like% 'NHL_control4%')%>%
select(-c(2:10, `Optical Brighteners`:ncol(.)))%>%
separate(`Sample Name`, c('Experiment', 'Treatment', 'Timepoint'), sep = '_')%>%
separate(Treatment, c('Treatment', 'Replicate'), sep = -1)
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Treatment, log10, color = Experiment)) +
geom_boxplot() +
geom_point() +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units)))) +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_change%>%
ggplot(aes(Treatment, log10(change), color = Experiment)) +
geom_boxplot() +
facet_wrap(~variable) +
gen_theme()
sdm_change%>%
ggplot(aes(Treatment, log10(change), color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A', "#00A08A")) +
facet_wrap(~variable) +
gen_theme()
sdm_change%>%
ggplot(aes(Treatment, log10(change), color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
facet_wrap(~variable) +
labs(y = bquote(Log[10] ~change ~over ~time)) +
gen_theme()
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Treatment, log10, color = Experiment)) +
geom_boxplot() +
geom_point() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units)))) +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.004, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.02, color = Experiment,
label = paste('Average =', round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.02, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment', label = 'Average') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.03, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release + 0.02, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release - 0.02, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release - 0.03, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release - 0.05, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release - 0.06, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
pdf('~/Documents/SDSU_Scripps/Haley/Tile_release_10x/plots.pdf', width = 15, height = 10)
sdm_change%>%
ggplot(aes(Treatment, log10(change), color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
facet_wrap(~variable) +
labs(y = bquote(Log[10] ~change ~over ~time)) +
gen_theme()
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Treatment, log10, color = Experiment)) +
geom_boxplot() +
geom_point() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units)))) +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release - 0.06, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
dev.off()
sdm_change%>%
ggplot(aes(Experiment, log10(change), color = Treatment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
facet_wrap(~variable) +
labs(y = bquote(Log[10] ~change ~over ~time)) +
gen_theme()
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Treatment, log10, color = Experiment)) +
geom_boxplot() +
geom_point() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units)))) +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Experiment, log10, color = Treatment)) +
geom_boxplot() +
geom_point() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units)))) +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Experiment, log10, color = Treatment)) +
geom_boxplot() +
geom_point() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units))), title = 'Day 14 release') +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release - 0.06, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release - 0.06, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment', title = 'Percent release compared to dissolved CCA exudates') +
gen_theme()
pdf('~/Documents/SDSU_Scripps/Haley/Tile_release_10x/plots.pdf', width = 15, height = 10)
sdm_change%>%
ggplot(aes(Experiment, log10(change), color = Treatment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
facet_wrap(~variable) +
labs(y = bquote(Log[10] ~change ~over ~time)) +
gen_theme()
sdm_14%>%
filter(variable != 'Phenylalanine-like')%>%
ggplot(aes(Experiment, log10, color = Treatment)) +
geom_boxplot() +
geom_point() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
labs(x = 'Treatment', y = bquote(Fluorescence ~(Log[10](Raman ~Units))), title = 'Day 14 release') +
facet_wrap(~variable, scales = 'free_y') +
gen_theme()
sdm_difference%>%
filter(variable != 'Phenylalanine-like')%>%
ungroup()%>%
ggplot(aes(variable, prcnt_release, color = Experiment)) +
geom_boxplot() +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
geom_text(data = pcnt_means, aes(variable, mean_release - 0.06, color = Experiment,
label = paste(round(mean_release, digits = 4)*100, '%', sep = "")), position = position_dodge2(1)) +
labs(x = 'Fluorophore', y = 'Percent release', color = 'Experiment', title = 'Percent release compared to dissolved CCA exudates') +
gen_theme()
dev.off()
