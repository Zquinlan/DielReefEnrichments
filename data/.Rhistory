geom_point()
org_nosc%>%
filter(activity == 'depletolite')%>%
ggplot(aes(Organism, N)) +
geom_boxplot()
org_nosc%>%
filter(activity == 'depletolite')%>%
ggplot(aes(Organism, P)) +
geom_boxplot()
View(org_nosc   )
org_nosc%>%
mutate(Organism2 = Organism)%>%
ggplot(aes(NOSC, log2_change, color = Organism)) +
facet_wrap(~activity) +
geom_point() +
geom_smooth(method = lm, aes(color = Organism2))
log2_change_vals%>%
left_join(networking%>%
select(feature_number, network, NOSC), by = "feature_number")%>%
filter(network != "-1")%>%
left_join(metadata%>%
select(feature_number, `row m/z`), by = "feature_number")%>%
left_join(net_activity, by = 'network')%>%
right_join(day_exometabolites, by = 'feature_number')%>%
filter(activity != 'recalcitrant')%>%
mutate(activity2 = activity)%>%
select(-c(T0,TF, complete_removal))%>%
gather(response_var, value, NOSC:`row m/z`)%>%
ggplot(aes(value, log2_change, color = activity)) +
facet_wrap(~ response_var, scales = 'free_x') +
geom_point(stat = 'summary', fun.y = mean) +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
new_scale('color') +
geom_smooth(method = lm, aes(color = activity2)) +
scale_color_manual(values = c('#3B9AB2', '#E1AF00')) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
)
org_nosc%>%
mutate(Organism2 = Organism)%>%
ggplot(aes(NOSC, log2_change, color = Organism)) +
facet_wrap(~activity) +
geom_point() +
geom_smooth(method = lm, aes(color = Organism2))
log2_change_vals%>%
left_join(networking%>%
select(feature_number, network, NOSC), by = "feature_number")%>%
filter(network != "-1")%>%
left_join(metadata%>%
select(feature_number, `row m/z`), by = "feature_number")%>%
left_join(net_activity, by = 'network')%>%
right_join(day_exometabolites, by = 'feature_number')%>%
filter(activity != 'recalcitrant')%>%
mutate(activity2 = activity)%>%
select(-c(T0,TF, complete_removal))%>%
gather(response_var, value, NOSC:`row m/z`)%>%
ggplot(aes(value, log2_change, color = activity)) +
facet_wrap(~ response_var, scales = 'free_x') +
geom_point(stat = 'summary', fun.y = mean) +
scale_color_manual(values = c('#78B7C5', '#EBCC2A')) +
new_scale('color') +
geom_smooth(method = lm, aes(color = activity2)) +
scale_color_manual(values = c('#3B9AB2', '#E1AF00')) +
theme(
# legend.position = "none",
# plot.margin = margin(2,.8,2,.8, "cm"),
axis.text.x = element_text(size = 20),
axis.text.y = element_text(size = 20),
panel.background = element_rect(fill = "transparent"), # bg of the panel
plot.background = element_rect(fill = "transparent", color = NA), # bg of the plot
panel.grid.major = element_blank(), # get rid of major grid
panel.grid.minor = element_blank(), # get rid of minor grid
legend.background = element_rect(fill = "transparent"), # get rid of legend bg
legend.box.background = element_rect(fill = "transparent")
)
View(exometabolite_features)
benthic_produced_exometabolites <- exometabolite_features%>%
filter(DayNight == 'Day',
Timepoint == 'T0')%>%
select(feature_number, Organism)%>%
mutate(bin = 'yes')
View(benthic_produced_exometabolites)
benthic_produced_exometabolites <- exometabolite_features%>%
filter(DayNight == 'Day',
Timepoint == 'T0')%>%
select(feature_number, Organism)%>%
mutate(bin = 'yes')%>%
spread(Organism, bin)
benthic_produced_exometabolites <- exometabolite_features%>%
filter(DayNight == 'Day',
Timepoint == 'T0')%>%
select(feature_number, Organism)%>%
mutate(bin = 'yes')%>%
spread(Organism, bin)%>%
mutate(dorcierr = 'yes')
is.na(benthic_produced_exometabolites) <- 'no'
benthic_produced_exometabolites[is.na(benthic_produced_exometabolites)] <- 'no'
benthic_produced_exometabolites <- exometabolite_features%>%
filter(DayNight == 'Day',
Timepoint == 'T0')%>%
select(feature_number, Organism)%>%
mutate(bin = 'yes')%>%
spread(Organism, bin)%>%
mutate(dorcierr = 'yes')
benthic_produced_exometabolites[is.na(benthic_produced_exometabolites)] <- 'no'
write_csv('./analysis/dorcierr_day_benthic_exometabolite_features.csv')
write_csv(benthic_produced_exometabolites, './analysis/dorcierr_day_benthic_exometabolite_features.csv')
linda <- read_csv('~/Downloads/Dorcierr_depletolites_Reduced_July2020.csv')
View(linda)
View(compound_prevalance)
# META-STATS --Compounds prevalance ---------------------------------------
compound_prevalance <- t_pvals%>%
mutate(exudate_type = 1)%>%
mutate(fdr_mixed = case_when(FDR_greater < 0.05 ~ FDR_greater,
FDR_lesser < 0.05 ~ FDR_lesser))%>%
select(c(1:3, activity, fdr_mixed))%>%
unite(org_act, c(Organism, activity), sep = "_")%>%
spread(org_act, fdr_mixed)%>%
group_by(DayNight, feature_number)
View(compound_prevalance)
linda <- read_csv('~/Downloads/Dorcierr_depletolites_Reduced_July2020.csv')%>%
select(-Feat_MinLog2)
linda_quadrant <- linda%>%
select(feature_number, quadrant)%>%
mutate(binary = 1)%>%
spread(quadrant, binary)%>%
group_by(feature_number)%>%
nest()%>%
mutate(data = map(data, ~ mutate(.x, reactivity = paste(colnames(.)[!is.na(.) > 0], sep = ", ", collapse = ", "))))
linda_quadrant <- linda%>%
select(feature_number, quadrant)%>%
group_by(feature_number)%>%
nest()%>%
mutate(data = map(data, ~apply(.x, 2, paste, collapse = "")))
View(linda_quadrant)
linda_quadrant <- linda%>%
select(feature_number, quadrant)%>%
group_by(feature_number)%>%
nest()%>%
mutate(data = map(data, ~apply(.x, 2, paste, collapse = ",")))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
nest()%>%
mutate(data = map(data, ~apply(.x, 2, paste, collapse = ", ")))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
mutate(quadrant = apply(.$quadrant, 2, paste, collapse = ", ")))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
mutate(quadrant = apply(.$quadrant, 2, paste, collapse = ", "))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
nest()%>%
mutate(quadrant = map(data, ~apply(.x$quadrant, 2, paste, collapse = ", ")))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
nest()%>%
mutate(quadrant = map(data, ~apply(.x[1], 2, paste, collapse = ", ")))
?summarize
summarize_all()
?summarize_all
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ",")
?mutate_all
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ",")%>%
mutate_all(~gsub("NA, " = ""))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ",")%>%
mutate_all(~ gsub("NA, " = "", .))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ",")%>%
mutate_all(gsub, "NA, " = "")
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ",")%>%
mutate_all(gsub, "NA, ", "")
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ",")%>%
mutate_all(funs(gsub("NA, ", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ",")%>%
mutate_all(funs(gsub("NA", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ",")%>%
mutate_all(funs(gsub("NA,", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .),
gsub(", NA", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, min, na.rm = TRUE))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, min, na.rm = TRUE))
funs(gsub("NA", "", .))%>%
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)),
funs(gsub("NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, min, na.rm = TRUE))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(str_c, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)),
funs(gsub("NA", "", .)))%>%)
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(str_c, collapse = ", ")
?str_c
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(str_c, sep = ", ")
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(str_c, collapse = ", ", na.rm = TRUE)
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(str_c, collapse = ", ")
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)),
funs(gsub("NA", "", .)))%>%)
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)),
funs(gsub("NA", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)),
funs(gsub("NA", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)),
funs(gsub(", NA", "", .)),
funs(gsub("NA", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], min, na.rm = TRUE))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, min, na.rm = TRUE))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
mutate_all(funs(gsub("NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, min, na.rm = TRUE))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
mutate_all(funs(gsub("NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, min, na.rm = TRUE))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, min, na.rm = TRUE))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE))
?replace_na
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE))
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE))%>%
left_join(linda%>%
select(-c(feature_number, quadrant, CCA:`Water control`))%>%
unique(),
by = 'feature_number')
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE))%>%
left_join(linda%>%
select(-c(quadrant, CCA:`Water control`))%>%
unique(),
by = 'feature_number')
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE),
feature_number = as.characer(feature_number))%>%
left_join(linda%>%
select(-c(quadrant, CCA:`Water control`))%>%
unique(),
by = 'feature_number')
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE),
feature_number = as.character(feature_number))%>%
left_join(linda%>%
select(-c(quadrant, CCA:`Water control`))%>%
unique(),
by = 'feature_number')
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE),
feature_number = as.numeric(feature_number))%>%
left_join(linda%>%
select(-c(quadrant, CCA:`Water control`))%>%
unique(),
by = 'feature_number')
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE),
feature_number = as.numeric(feature_number))%>%
left_join(linda%>%
select(-c(quadrant, CCA:`Water control`))%>%
unique(),
by = 'feature_number')%>%
left_join(benthic_produced_exometabolites,
by = 'feature_number')
mutate(feature_number = as.character(feature_number),
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE))%>%
left_join(linda%>%
select(-c(quadrant, CCA:`Water control`))%>%
unique()%>%
mutate(feature_number = as.character(feature_number)),
by = 'feature_number')%>%
left_join(benthic_produced_exometabolites,
by = 'feature_number')
benthic_produced_exometabolites <- exometabolite_features%>%
filter(DayNight == 'Day',
Timepoint == 'T0')%>%
select(feature_number, Organism)%>%
mutate(bin = 'yes',
dorc_prd = "produced")%>%
combine(Organism, c('Organism', 'dorc_prd'), sep = '_')%>%
spread(Organism, bin)%>%
mutate(dorcierr = 'yes')
?combine
?separate
benthic_produced_exometabolites <- exometabolite_features%>%
filter(DayNight == 'Day',
Timepoint == 'T0')%>%
select(feature_number, Organism)%>%
mutate(bin = 'yes',
dorc_prd = "produced")%>%
unite(Organism, c('Organism', 'dorc_prd'), sep = '_')%>%
spread(Organism, bin)%>%
mutate(dorcierr = 'yes')
benthic_produced_exometabolites[is.na(benthic_produced_exometabolites)] <- 'no'
linda_quadrant <- linda%>%
select(feature_number, quadrant, CCA:`Water control`)%>%
unique()%>%
group_by(feature_number)%>%
summarize_all(paste0, collapse = ", ")%>%
mutate_all(funs(gsub("NA, ", "", .)))%>%
mutate_all(funs(gsub(", NA", "", .)))%>%
na_if("NA")%>%
mutate(Feat_MinLog2 = apply(.[3:8], 1, max, na.rm = TRUE))%>%
left_join(linda%>%
select(-c(quadrant, CCA:`Water control`))%>%
unique()%>%
mutate(feature_number = as.character(feature_number)),
by = 'feature_number')%>%
left_join(benthic_produced_exometabolites,
by = 'feature_number')
write_csv(linda_quadrant, '~/Downloads/Dorcierr_depletolites_Reduced_July2020_zaq_changes.csv')
